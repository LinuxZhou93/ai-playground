<!DOCTYPE html>
<html lang="zh-CN" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creative Coding Lab | ÂàõÊÑèÁºñÁ®ãÂÆûÈ™åÂÆ§</title>

    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Configure Tailwind -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        scratch: {
                            orange: '#FFAB19', // Scratch 3.0 Orange
                            purple: '#855CD6', // Scratch 3.0 Purple
                            cyan: '#4D97FF',   // Scratch 3.0 Blue
                            green: '#4CBF56'   // Scratch 3.0 Green
                        }
                    },
                    fontFamily: {
                        sans: ['Outfit', 'Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Outfit', sans-serif;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }

        .blob-bg {
            position: absolute;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(77, 151, 255, 0.15) 0%, rgba(0, 0, 0, 0) 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: -1;
        }
    </style>
</head>

<body
    class="bg-slate-900 text-slate-200 min-h-screen selection:bg-scratch-orange selection:text-white overflow-x-hidden">

    <div id="app" class="flex flex-col min-h-screen relative">
        <!-- Background Effects -->
        <div class="blob-bg top-[-200px] left-[-200px]"></div>
        <div
            class="blob-bg bottom-[-200px] right-[-200px] bg-[radial-gradient(circle,rgba(255,171,25,0.15)_0%,rgba(0,0,0,0)_70%)]">
        </div>

        <!-- Navbar -->
        <nav
            class="h-20 border-b border-slate-700/50 bg-slate-900/80 backdrop-blur z-50 flex items-center justify-between px-6 lg:px-12 sticky top-0">
            <div class="flex items-center gap-4">
                <a href="index.html" class="p-2 rounded-lg hover:bg-slate-800 transition-colors">
                    <svg width="24" height="24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                </a>
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-xl bg-gradient-to-br from-scratch-orange to-red-500 flex items-center justify-center text-white font-black text-xl shadow-lg shadow-orange-500/20">
                        C</div>
                    <div>
                        <h1 class="font-bold text-white text-lg leading-tight" data-i18n="site_title">Creative Lab</h1>
                        <div class="text-[10px] text-slate-500 uppercase tracking-widest font-bold"
                            data-i18n="site_subtitle">Code Your World
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <button @click="toggleLanguage"
                    class="px-4 py-2 rounded-lg border border-slate-600 hover:border-scratch-cyan transition-colors text-sm font-bold flex items-center gap-2">
                    <svg width="16" height="16" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
                    </svg>
                    <span>{{ currentLang === 'zh' ? 'EN' : '‰∏≠Êñá' }}</span>
                </button>
                <div v-if="user"
                    class="flex items-center gap-3 bg-slate-800/50 rounded-full pl-1 pr-4 py-1 border border-slate-700">
                    <div class="w-8 h-8 rounded-full bg-slate-700 overflow-hidden">
                        <img v-if="user.avatar_url" :src="user.avatar_url" class="object-cover w-full h-full">
                        <span v-else class="flex w-full h-full items-center justify-center">üë§</span>
                    </div>
                    <span class="text-sm font-bold text-slate-300">{{ user.username || 'Creator' }}</span>
                </div>
                <button v-else @click="loginWithGithub"
                    class="px-5 py-2 rounded-full border border-slate-600 hover:border-white transition-colors text-sm font-bold"
                    data-i18n="login">
                    Login
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 w-full max-w-7xl mx-auto p-6 lg:p-12">

            <!-- Hero / Create Section -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
                <!-- Create Scratch -->
                <div
                    class="group relative bg-slate-800/40 rounded-3xl p-8 border border-slate-700 overflow-hidden hover:border-scratch-purple transition-all duration-300 hover:shadow-[0_0_30px_rgba(133,92,214,0.2)]">
                    <div
                        class="absolute top-0 right-0 w-64 h-64 bg-scratch-purple/10 rounded-full blur-3xl -mr-16 -mt-16 group-hover:bg-scratch-purple/20 transition-colors">
                        class="text-scratch-green transform -rotate-12 translate-x-4 translate-y-4">
                        <rect x="20" y="30" width="60" height="40" rx="10" />
                        <circle cx="85" cy="50" r="10" />
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Gallery Filter -->
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-2xl font-bold text-white" data-i18n="community_lab">Community Lab</h2>
                <div class="flex bg-slate-800 rounded-lg p-1">
                    <button @click="filter = 'all'" :class="{'bg-slate-700 text-white shadow': filter === 'all'}"
                        class="px-4 py-1.5 rounded-md text-sm font-medium text-slate-400 transition-all"
                        data-i18n="filter_all">All</button>
                    <button @click="filter = 'my'" :class="{'bg-slate-700 text-white shadow': filter === 'my'}"
                        class="px-4 py-1.5 rounded-md text-sm font-medium text-slate-400 transition-all"
                        data-i18n="filter_my">My
                        Projects</button>
                    <button @click="filter = 'featured'"
                        :class="{'bg-slate-700 text-white shadow': filter === 'featured'}"
                        class="px-4 py-1.5 rounded-md text-sm font-medium text-slate-400 transition-all"
                        data-i18n="filter_featured">Featured</button>
                </div>
            </div>

            <!-- Projects Grid -->
            <div v-if="loading" class="text-center py-20">
                <div
                    class="animate-spin w-12 h-12 border-4 border-slate-700 border-t-scratch-cyan rounded-full mx-auto mb-4">
                </div>
                <p class="text-slate-500" data-i18n="loading">Loading works...</p>
            </div>

            <div v-else-if="projects.length === 0"
                class="text-center py-20 bg-slate-800/20 rounded-3xl border border-dashed border-slate-700">
                <div class="text-4xl mb-4">üé®</div>
                <h3 class="text-xl font-bold text-white mb-2" data-i18n="no_projects">No projects yet</h3>
                <p class="text-slate-500" data-i18n="be_first">Be the first to create something amazing!</p>
            </div>

            <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Project Card -->
                <div v-for="project in projects" :key="project.id"
                    class="group bg-slate-800 border border-slate-700 rounded-2xl overflow-hidden hover:border-slate-500 transition-all hover:-translate-y-1">
                    <!-- Thumbnail -->
                    <div class="aspect-video bg-slate-900 relative overflow-hidden">
                        <img v-if="project.thumbnail_url" :src="project.thumbnail_url"
                            class="w-full h-full object-cover">
                        <div v-else class="w-full h-full flex items-center justify-center bg-slate-800 text-slate-600">
                            <svg width="40" height="40" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01" />
                            </svg>
                        </div>

                        <!-- Type Badge -->
                        <div
                            class="absolute top-2 left-2 px-2 py-1 rounded bg-black/50 backdrop-blur text-[10px] font-bold text-white border border-white/10 uppercase">
                            {{ project.type }}
                        </div>
                    </div>

                    <!-- Info -->
                    <div class="p-4">
                        <h3 class="font-bold text-white truncate mb-1">{{ project.title }}</h3>
                        <div class="flex items-center justify-between text-xs text-slate-500">
                            <span class="flex items-center gap-1">
                                <span class="truncate max-w-[80px]">By {{ project.profiles?.username || 'User' }}</span>
                            </span>
                            <span class="flex items-center gap-2">
                                <span class="flex items-center gap-1">üëÅÔ∏è {{ project.view_count || 0 }}</span>
                                <span class="flex items-center gap-1">‚ù§Ô∏è {{ project.likes || 0 }}</span>
                            </span>
                        </div>

                        <div class="mt-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button
                                class="flex-1 py-1.5 bg-white text-slate-900 rounded font-bold text-xs hover:bg-slate-200"
                                data-i18n="play">Play</button>
                            <button
                                class="flex-1 py-1.5 bg-slate-700 text-white rounded font-bold text-xs hover:bg-slate-600"
                                data-i18n="remix">Remix</button>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        const { createApp, ref, onMounted, watch } = Vue;

        // Mock Supabase Config (Replace with real logic if available)
        const SUPABASE_URL = 'https://znmbkxmnwuurzhevfxtq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpubWJreG1ud3V1cnpoZXZmeHRxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1Nzk1MDQsImV4cCI6MjA4MDE1NTUwNH0.y0m9rnug3WduVyuKZLL25PBA4C2Ys0_WSgMrzokSh5g';

        createApp({
            setup() {
                const user = ref(null);
                const loading = ref(true);
                const projects = ref([]);
                const filter = ref('all');
                let supabase = null;

                if (window.supabase && window.supabase.createClient) {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                }

                const loginWithGithub = async () => {
                    // Placeholder auth
                    alert("Please login via the main site first.");
                };

                const fetchProjects = async () => {
                    if (!supabase) {
                        loading.value = false;
                        return;
                    }

                    loading.value = true;
                    // Mock query if table doesn't exist yet, or real query
                    try {
                        let query = supabase.from('projects').select('*, profiles(username)');

                        if (filter.value === 'my' && user.value) {
                            query = query.eq('author_id', user.value.id);
                        }
                        // Add other filters

                        const { data, error } = await query;
                        if (error && error.code !== 'PGRST116') { // Ignore missing table error for now
                            console.log('Error fetching projects (Table might not exist yet)', error);
                            // Mock data for display
                            projects.value = [
                                { id: 1, title: 'Flying Cat Demo', type: 'scratch', view_count: 102, likes: 45 },
                                { id: 2, title: 'My First Story', type: 'scratch-jr', view_count: 56, likes: 12 },
                            ];
                        } else {
                            projects.value = data || [];
                        }
                    } catch (e) {
                        console.error(e);
                    } finally {
                        loading.value = false;
                    }
                };

                watch(filter, () => {
                    fetchProjects();
                });

                onMounted(async () => {
                    if (supabase) {
                        const { data } = await supabase.auth.getUser();
                        user.value = data.user;

                        // If logged in, get profile
                        if (user.value) {
                            const { data: profile } = await supabase.from('profiles').select('*').eq('id', user.value.id).single();
                            if (profile) user.value = { ...user.value, ...profile };
                        }
                    }

                    fetchProjects();
                });

                // Language switching
                const currentLang = ref(localStorage.getItem('coding_lang') || 'zh');

                const translations = {
                    zh: {
                        site_title: 'ÂàõÊÑèÂÆûÈ™åÂÆ§',
                        site_subtitle: 'ÁºñÁ®ã‰Ω†ÁöÑ‰∏ñÁïå',
                        login: 'ÁôªÂΩï',
                        age_8plus: 'üöÄ ÈÄÇÂêà 8 Â≤Å‰ª•‰∏ä',
                        scratch_mode: 'Scratch Ê®°Âºè',
                        scratch_desc: 'ÂÆåÊï¥ÁöÑÁßØÊú®ÁºñÁ®ã„ÄÇÂàõÂª∫Ê∏∏Êàè„ÄÅÂä®ÁîªÂíå‰∫íÂä®ÊïÖ‰∫ãÔºå‰ΩøÁî®Âº∫Â§ßÁöÑÈÄªËæëÁßØÊú®„ÄÇ',
                        start_creating: 'ÂºÄÂßãÂàõ‰Ωú',
                        age_5to7: 'üê± ÈÄÇÂêà 5-7 Â≤Å',
                        scratchjr_mode: 'Scratch Jr Ê®°Âºè',
                        scratchjr_desc: 'Âü∫‰∫éÂõæÊ†áÁöÑÁºñÁ®ãÂÖ•Èó®„ÄÇÁî®ÁÆÄÂçïÁöÑÊãñÊîæÁßØÊú®ËÆ≤ÊïÖ‰∫ãÂíåÁßªÂä®ËßíËâ≤„ÄÇ',
                        community_lab: 'ÂàõÊÑèÁ©∫Èó¥',
                        filter_all: 'ÂÖ®ÈÉ®',
                        filter_my: 'ÊàëÁöÑÈ°πÁõÆ',
                        filter_featured: 'Á≤æÈÄâ',
                        loading: 'Âä†ËΩΩ‰∏≠...',
                        no_projects: 'ËøòÊ≤°ÊúâÈ°πÁõÆ',
                        be_first: 'Êàê‰∏∫Á¨¨‰∏Ä‰∏™Âàõ‰ΩúÁ≤æÂΩ©‰ΩúÂìÅÁöÑ‰∫∫ÔºÅ',
                        play: 'Êí≠Êîæ',
                        remix: 'ÊîπÁºñ'
                    },
                    en: {
                        site_title: 'Creative Lab',
                        site_subtitle: 'Code Your World',
                        login: 'Login',
                        age_8plus: 'üöÄ For Ages 8+',
                        scratch_mode: 'Scratch Mode',
                        scratch_desc: 'Full-featured block coding. Create games, animations, and interactive stories with powerful logic blocks.',
                        start_creating: 'Start Creating',
                        age_5to7: 'üê± For Ages 5-7',
                        scratchjr_mode: 'Scratch Jr Mode',
                        scratchjr_desc: 'Icon-based coding for beginners. Tell stories and move characters with simple tap-and-drag blocks.',
                        community_lab: 'Community Lab',
                        filter_all: 'All',
                        filter_my: 'My Projects',
                        filter_featured: 'Featured',
                        loading: 'Loading works...',
                        no_projects: 'No projects yet',
                        be_first: 'Be the first to create something amazing!',
                        play: 'Play',
                        remix: 'Remix'
                    }
                };

                const setLanguage = (lang) => {
                    currentLang.value = lang;
                    localStorage.setItem('coding_lang', lang);

                    // Update all elements with data-i18n
                    document.querySelectorAll('[data-i18n]').forEach(el => {
                        const key = el.getAttribute('data-i18n');
                        if (translations[lang][key]) {
                            el.textContent = translations[lang][key];
                        }
                    });
                };

                const toggleLanguage = () => {
                    setLanguage(currentLang.value === 'zh' ? 'en' : 'zh');
                };

                onMounted(async () => {
                    if (supabase) {
                        const { data } = await supabase.auth.getUser();
                        user.value = data.user;

                        // If logged in, get profile
                        if (user.value) {
                            const { data: profile } = await supabase.from('profiles').select('*').eq('id', user.value.id).single();
                            if (profile) user.value = { ...user.value, ...profile };
                        }
                    }

                    fetchProjects();

                    // Initialize language
                    setTimeout(() => setLanguage(currentLang.value), 100);
                });

                return {
                    user,
                    loading,
                    projects,
                    filter,
                    loginWithGithub,
                    currentLang,
                    toggleLanguage
                };
            }
        }).mount('#app');
    </script>
</body>

</html>